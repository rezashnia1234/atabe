<!DOCTYPE html>
<html>
<head>
<title>بسم الله الرحمن الرحیم</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" type="text/css" href="css/reset.css">
<link rel="stylesheet" type="text/css" href="css/font.css">

<link rel="stylesheet" href="maps/js/leaflet.css" />
<link rel="stylesheet" href="maps/js/leaflet-search.css" />
<link rel="stylesheet" href="maps/js/leaflet-routing-machine.css" />
<link rel="stylesheet" href="maps/js/style.css" />

<script src="js/jquery-3.0.0.min.js"></script>
<!--<script src="js/console.log.js"></script>-->
<script src="phonegap.js"></script>
<script src="js/fastclick.js"></script>
<script>
	var my_location_gps;
	function getParameterByName(name) {
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
			results = regex.exec(location.search);
		return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}
    $( document ).ready(function() {
        console.log( "document loaded" );
		
    });
	function init() {		
		console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start init()');
		document.addEventListener("deviceready", onDeviceReady, false);
		radius = 0;
		my_location_marker = L.marker([36.2879,59.6157], {icon: user_location_icon,zIndexOffset: 999}).addTo(map);
		my_location_circle = L.circle([36.2879,59.6157], radius).addTo(map);
		
		onDeviceReady();
	}
	
	function onDeviceReady() {
		console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start onDeviceReady()');
		//FastClick.attach(document.getElementById('button'));
		/**/
		(function(){
			console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start getCurrentPosition()');
			navigator.geolocation.getCurrentPosition(onSuccess, onError);
			//console.log("11");
			setTimeout(arguments.callee, 5000);
		})();
		
	}
	function onSuccess(position) {
		console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start onSuccess()');
		//alert("longitude : " + position.coords.longitude);
		//alert("latitude  : " + position.coords.latitude );
		
		//user_location_icon	= new icon_style_user_location({iconUrl: 'maps/map-icon/user_location.png',iconRetinaUrl: 'maps/map-icon/user_location@2x.png',});
		radius = (position.coords.accuracy / 2) * 1;
		//my_location_marker = L.marker([position.coords.latitude,position.coords.longitude], {icon: user_location_icon}).addTo(map).bindPopup("شما در شعاع " + radius + " متری این نقطه هستید");//.openPopup();
		//my_location_circle = L.circle([position.coords.latitude,position.coords.longitude], radius).addTo(map);
		my_location_marker.setLatLng([position.coords.latitude,position.coords.longitude]);
		my_location_marker.bindPopup("شما در شعاع " + radius + " متری این نقطه هستید");
		my_location_circle.setLatLng([position.coords.latitude,position.coords.longitude]);
		my_location_circle.setRadius(radius);
		
		$("#location_btn").addClass("active");
				
	}
	
	function onError(error) { 
		// your callback here
		//alert(JSON.stringify(error));
	}
</script>
</head>

<body onload="init();">
	<div id="favorites_btn" class="top_left_smcms_btn" ></div>
	<div id="wifi_btn" class="top_left_smcms_btn" ></div>
	<div id="location_btn" class="top_left_smcms_btn" ></div>
	<div id="routing_btn" class="top_left_smcms_btn" ></div>
	<div id="map"></div>

	<div class="cd-popup is-visible0 favorites" role="alert">
		<div class="cd-popup-container">
			<p><input id="favorite_title" id="favorite_title" placeholder="عنوان نقطه جدید" /></p>
			<ul class="cd-buttons">
				<li><a href="#" onclick="add_to_favorites();">تایید</a></li>
				<li><a href="#" onclick="add_to_favorites_open();">لغو</a></li>
			</ul>
			<!--<a href="#0" class="cd-popup-close img-replace">Close</a>-->
		</div> <!-- cd-popup-container -->
	</div> <!-- cd-popup -->

	<div class="cd-popup is-visible0 route_from" role="alert">
		<div class="cd-popup-container">
			<p>لطفا مبدا سفر را انتخاب نمایید</p>
			<ul class="cd-buttons">
				<li><a href="#" onclick="routing_to_open();" style="background-color:#247dc9;">تایید</a></li>
				<li><a href="#" onclick="routing_open();">لغو</a></li>
			</ul>
			<!--<a href="#0" class="cd-popup-close img-replace">Close</a>-->
		</div> <!-- cd-popup-container -->
	</div> <!-- cd-popup -->

	<div class="cd-popup is-visible0 route_to" role="alert">
		<div class="cd-popup-container">
			<p>لطفا مقصد سفر را انتخاب نمایید</p>
			<ul class="cd-buttons">
				<li><a href="#" onclick="routinging_start();" style="background-color:#ce3b39;">تایید</a></li>
				<li><a href="#" onclick="routing_open();">لغو</a></li>
			</ul>
			<!--<a href="#0" class="cd-popup-close img-replace">Close</a>-->
		</div> <!-- cd-popup-container -->
	</div> <!-- cd-popup -->



<script src="maps/js/leaflet-src.js"></script>
<script src="maps/js/leaflet-search.js"></script>
<script src="maps/js/leaflet-routing-machine.min.js"></script> 
<script src="maps/js/Control.Geocoder.js"></script>

<script src="maps/js/fuse.min.js"></script>
<script src="maps/js/points.json"></script>

<script>

	
		
	var icon_style_favorites_new = L.Icon.extend({
		options: {
			iconSize:     [25, 41], // size of the icon
			iconAnchor:   [12,41], // point of the icon which will correspond to marker's location
			popupAnchor:  [0, -41], // point from which the popup should open relative to the iconAnchor
			shadowSize:   [41, 41],
			shadowAnchor: [11, 39]
		}
	});
	var icon_style_user_location = L.Icon.extend({
		options: {
			iconSize:     [44, 59], // size of the icon
			iconAnchor:   [22,59], // point of the icon which will correspond to marker's location
			popupAnchor:  [0, -59] // point from which the popup should open relative to the iconAnchor
		}
	});
	var all_normal_icons = L.Icon.extend({
		options: {
			iconSize:     [33, 44], // size of the icon
			iconAnchor:   [16,44], // point of the icon which will correspond to marker's location
			popupAnchor:  [0, -44] // point from which the popup should open relative to the iconAnchor
		}
	});
	var	user_location_icon	= new all_normal_icons({iconUrl: 'maps/map-icon/user_location.png',iconRetinaUrl: 'maps/map-icon/user_location@2x.png',});
	var	from_icon			= new all_normal_icons({iconUrl: 'maps/map-icon/a.png',iconRetinaUrl: 'maps/map-icon/a@2x.png',});
	var	to_icon				= new all_normal_icons({iconUrl: 'maps/map-icon/b.png',iconRetinaUrl: 'maps/map-icon/b@2x.png',});
	


	var offline_map = L.tileLayer('maps/mapquest/{z}/{x}/{y}.png', {maxZoom: 16}),
		online_map  = L.tileLayer('http://imamali.net/app-json/map/{z}/{x}/{y}.png', {maxZoom: 18});
	

		lat_center=32.0192;
		long_center=44.3298;
	var map_center = new L.latLng(lat_center,long_center);
	var map = L.map('map', {
		zoom: 14,
		maxZoom: 16,//17
		minZoom:1,
		center: map_center,
		layers: online_map,//L.tileLayer('maps/mapquest/{z}/{x}/{y}.png'),
		zoomControl:false
	});


		
		
	//console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    fihish()');
</script>
<style>


</style>


</body>
</html>
