<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<title></title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<link rel="stylesheet" href="http://labs.easyblog.it/maps/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="http://labs.easyblog.it/maps/leaflet-search/src/leaflet-search.css" />
<link rel="stylesheet" href="http://labs.easyblog.it/maps/leaflet-search/style.css" />
</head>

<body>
<div id="map"></div>



<script src="http://labs.easyblog.it/maps/leaflet/dist/leaflet-src.js"></script>
<script src="http://labs.easyblog.it/maps/leaflet-search/src/leaflet-search.js"></script>

<script src="http://cdnjs.cloudflare.com/ajax/libs/fuse.js/1.2.2/fuse.min.js"></script>
<script src="maps/js/points.json"></script>
<script>
var categories = {
    101 : {desc: "اماکن المقدسة", icon:"museum_archeological.png"},/////////////
    102 : {desc: "الأماكن المفضلة ", icon:"mural.png"},
    103 : {desc: "مراكز صحية", icon:"mural.png"},///////////////////////////////
    104 : {desc: "استراحات الزائرين", icon:"mural.png"},
    105 : {desc: "نقاط التفتيش", icon:"music_choral.png"},
    106 : {desc: "فنادق", icon:"museum_art.png"},///////////////////////////////
    107 : {desc: "اعمدة", icon:"theater.png"},//////////////////////////////////
    108 : {desc: "محطات النقل", icon:"cinema.png"},/////////////////////////////
    109 : {desc: "مراكز المفقودين", icon:"cinema.png"},
    110 : {desc: "القنصليات", icon:"cinema.png"},
    111 : {desc: "خدمات الزائرين", icon:"cinema.png"},
};
var setupIcons = function() {

    var icons = {};
    for (var cat in categories) {
        var icon = categories[cat].icon;
        var url = "maps/images/" + icon;
 
        var icon = L.icon({
            iconUrl: url,
            iconSize: [32, 32],
            iconAnchor: [16, 37],
            popupAnchor: [0, -28]
        });
        icons[cat] = icon;
    }
    
    return icons;
};
var icons = setupIcons();





var map = L.map('map', {
		zoom: 12,
		center: new L.latLng(32.0192,44.3298),
		layers: L.tileLayer('http://imamali.net/app-json/map/{z}/{x}/{y}.png')
	});
	
	

	
	
// Layer control, setting up 1 layer per category
var layers = {},
	cultureLayer = L.layerGroup(),
	layerCtrl = L.control.layers();
for (var icat in categories) {
	var layer = L.featureGroup();
	layers[icat] = layer;
	cultureLayer.addLayer(layer);
	
	var cat = categories[icat],
		desc = '<img class="layer-control-img" src="maps/images/' + cat.icon + '"> ' + cat.desc;
	layerCtrl.addOverlay(layer, desc);
}
cultureLayer.addTo(map);


	var restLayers = L.geoJson(restaurant500, {
			pointToLayer: function(feature, latlng) {
				var cat = feature.properties.categorie;
				var icon = icons[cat];
				
				var props = L.Util.extend({
							'name': '',
							'cuisine': '',
							'website': '',
							'phone': ''
						},feature.properties),
					textPopup = L.Util.template("<h3>{name}</h3>", props),
					style = {
						radius: 5,
						opacity: 0.8,
						fillColor: '#ddd',
						fillOpacity: 0.8
					};

				//return L.circleMarker(latlng, style).bindPopup(textPopup);
				return L.marker(latlng, {icon: icon,keyboard: false,riseOnHover: true});
			}
		}).addTo(map);
		
		
		

		
		
	var fuse = new Fuse(restaurant500.features, {
		keys: ['properties.name']
	});

	L.control.search({
		layer: restLayers,
		propertyName: 'name',
		filterData: function(text, records) {
			var jsons = fuse.search(text),
				ret = {}, key;
			
			for(var i in jsons) {
				key = jsons[i].properties.name;
				ret[ key ]= records[key];
			}

			console.log(jsons,ret);
			return ret;
		}
	})
	.on('search_locationfound', function(e) {
		e.layer.openPopup();
	})
	.addTo(map);

layerCtrl.addTo(map);
</script>



</body>
</html>
