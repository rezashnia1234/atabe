<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
    <title>بسم الله الرحمن الرحيم</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/template.css">

	<script src="js/jquery-2.2.2.min.js"></script>
    <script src="cordova.js"></script>
    <script src="js/fastclick.js"></script>
    <script src="js/hammer.min.js"></script>
	<script type="text/javascript" src="js/iscroll.js"></script>
	<script>
		var does_we_have_intenet = true;
		function init() {
			var pano_url;
			console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    start init()');
			document.addEventListener("deviceready", onDeviceReady, false);
			/**** added by mahdi *********/
			if(isRetina())
			{
				$('.retina').each( function(i) {
					var back = $(this).css('background-image');
					back = back.replace("/low", "/high");
					$(this).css('background-image',back);
				});
				$('.retina:before').each( function(i) {
					var back = $(this).css('background-image');
					back = back.replace("/low", "/high");
					$(this).css('background-image',back);
				});
			}
// 			$('.smm_menu > div').fancy_scroll({
// 			      innerWrapper: ".smm_menu ul",
// 			      animation: "bounce",
// 			  		bounceDistance: 40,
// 			  		animDuration: "0.3s",
// 			  		animEasing: "cubic-bezier(0.175, 0.885, 0.420, 1.310)"
// 			    });
			var myScroll = new iScroll('smm_wrapper', { hideScrollbar: true, bounce : "enable", vScrollbar: false });
			/*****************************/
		}

		function goto_next_page(href,need_internet) {
			if (window.cordova)
			{
				var networkState = navigator.connection.type;
				if ((networkState == Connection.NONE) && need_internet) {
					navigator.notification.alert(
						'شما برای مشاهده این صفحه نیاز به اینترنت دارید',  // message
						alertDismissed,         // callback
						'اخطار',            // title
						'تائید'                  // buttonName
					);
					function alertDismissed(){};
				}
				else
				{
					if ( device.platform == 'iOS' )
					{
						var options_back = {
						  "direction"		:	"left", // "up", // 'left|right|up|down', default 'left' (which is like 'next')
						  "duration"		:	700, // in milliseconds (ms), default 400
						  "androiddelay"	:	130, // same as above but for Android, default 70
						  "href"			:	href //"adab.html"
						};
						window.plugins.nativepagetransitions.slide(
						  options_back,
						  function (msg) {console.log("success: " + msg)}, // called when the animation has finished
						  function (msg) {alert("error: " + msg)} // called in case you pass in weird values
						);
					}
					else
					{
						var options_back = {
						  "direction"		:	"left", // "up", // 'left|right|up|down', default 'left' (which is like 'next')
						  "duration"		:	1100, // in milliseconds (ms), default 400
						  "iosdelay"		:	110,
						  "androiddelay"	:	140, // same as above but for Android, default 70
						  "href"			:	href //"adab.html"
						};
						window.plugins.nativepagetransitions.flip(
						  options_back,
						  function (msg) {console.log("success: " + msg)}, // called when the animation has finished
						  function (msg) {alert("error: " + msg)} // called in case you pass in weird values
						);
					}
				}
			} else {
				window.location.href = href;
			}

		}
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START push Notification :////////////////////////////////////////////////////////////////
	 var register_for_notifs;// = window.sessionStorage.getItem('register_for_notifs');
	 function onNotificationGCM(e) {
		//alert("uuuuuu");
		//$("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');

		switch( e.event )
		{
		case 'registered':
			if ( e.regid.length > 0 )
			{
				//$("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
				// Your GCM push server needs to know the regID before it can push to this device
				// here is where you might want to send it the regID for later use.
				//console.log("regID = " + e.regid);
				//alert("regID = " + e.regid);
				//if(register_for_notifs){
					var temp_udid;
					if(window.localStorage.getItem('uuid') == null)
					{
						window.plugins.uniqueDeviceID.get(uniqueDeviceIDsuccess_index, uniqueDeviceIDfail_index);
						temp_udid	=	"";
					}
					else
					{
						var temp_udid = window.localStorage.getItem('uuid');
					}
					$.ajax({ type: "POST",
							url: "http://imamali.net/app-json/set_new_user.php", 
							data: {regID : e.regid,user:window.localStorage.getItem('uuid'),OS:device.platform},
							async: false,
							success : function(text)
							{
								//last_articles_version = text;
								console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification registration text : ' + text);
								window.sessionStorage.setItem('register_for_notifs','yes');
							}
					});
				//}
			}
		break;

		case 'message':
			// if this flag is set, this notification happened while we were in the foreground.
			// you might want to play a sound to get the user's attention, throw up a dialog, etc.
			if ( e.foreground )
			{
				//$("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');

				// if the notification contains a soundname, play it.
				//var my_media = new Media("/android_asset/www/"+e.soundname);
				//my_media.play();
			}
			else
			{  // otherwise we were launched because the user touched a notification in the notification tray.
				/*
				if ( e.coldstart )
				{
					$("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
				}
				else
				{
					$("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
				}
				*/
			}
			
			//alert(e.payload.message);
			navigator.notification.alert(
				e.payload.message,  // message
				alertDismissed,         // callback
				'اطلاعیه',            // title
				'تائید'                  // buttonName
			);
			//alert(e.payload.msgcnt);
			/*
			$("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
			$("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
			*/
		break;

		case 'error':
			//$("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
		break;

		default:
			//$("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
		break;
	  }
	}
	function successHandler (result) {
		//alert('result = ' + result);
	}
	// result contains any error description text returned from the plugin call
	function errorHandler (error) {
		//alert('error = ' + error);
	}
// END push Notification ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
		function onDeviceReady() {
			var networkState = navigator.connection.type;
			if (networkState == Connection.NONE) {
				does_we_have_intenet = false;
			}
			FastClick.attach(document.body);
			if ( device.platform == 'Android' ){//Android,iOS,win7=WinCE,win8=Win32NT
				document.addEventListener("backbutton", go_back_index, false);
			}			
			if ( device.platform == 'Android' ){//Android,iOS,win7=WinCE,win8=Win32NT
				$(".PrayTimes_page").attr("onclick","goto_next_page('salat-gps.html',false);");
			}		
			
			if(window.localStorage.getItem('uuid') == null)
				window.plugins.uniqueDeviceID.get(uniqueDeviceIDsuccess_index, uniqueDeviceIDfail_index);
			else
			{
				
			}
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
// START push Notification :////////////////////////////////////////////////////////////////
			if (networkState == Connection.NONE) {
			
			}
			else
			{
				if(window.sessionStorage.getItem('register_for_notifs') == null)
				{
					pushNotification = window.plugins.pushNotification;
					console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    register_for_notifs : no // ' + device.platform);
					if ( device.platform == 'android' || device.platform == 'Android' || device.platform == "amazon-fireos" ){
						pushNotification.register(successHandler,errorHandler,{"senderID":"804625540618","ecb":"onNotificationGCM"});
					} else {
						pushNotification.register(tokenHandler,errorHandler,{"badge":"true","sound":"true","alert":"true","ecb":"onNotificationGCM"});//"onNotificationAPN"});
					}
				}
			}
			function tokenHandler(result) {
				console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification Callback Success! Result (ios) = '+result);
				
				var temp_udid;
				if(window.localStorage.getItem('uuid') == null)
				{
					window.plugins.uniqueDeviceID.get(uniqueDeviceIDsuccess_index, uniqueDeviceIDfail_index);
					temp_udid	=	"";
				}
				else
				{
					var temp_udid = window.localStorage.getItem('uuid');
				}
				//if(register_for_notifs){
					$.ajax({ type: "POST",
							url: "http://imamali.net/app-json/set_new_user.php", 
							data: {regID : result,user:window.localStorage.getItem('uuid'),OS:device.platform},
							async: false,
							success : function(text)
							{
								//last_articles_version = text;
								console.log('SMGROUP ::::::::::::::::::::::::::::::::::::    Notification registration text : ' + text);
								window.sessionStorage.setItem('register_for_notifs','yes');
							}
					});
				//}
			}
// END push Notification ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////
		}

		$(window).load(function() {		
			setTimeout(function(){
				$(".mypreload").html("");
			}, 1000);
			
			var ulwidth = $('.smm_menu ul').height()*10/11;
			var divwidth = $('.smm_menu > div').height();

			$('.smm_menu ul').css('top',(divwidth-ulwidth));
			setTimeout(function(){
				$('.smm_menu ul').css("top","0");
			}, 1500);
		});

		function go_back_index() {
			navigator.app.exitApp();
			/*
			navigator.notification.confirm(
				'آيا تمايل به خروج از برنامه را داريد؟',	// message
				onExitConfirm,								// callback
				'توجه',										// title
				['بله','خير']								// buttonName
			);
			*/
		}
		function onExitConfirm(buttonIndex) {
			if(buttonIndex==1)
			{
				navigator.app.exitApp();
				/*
				if (navigator && navigator.app) {
					navigator.app.exitApp();
				} 
				else {
					if (navigator && navigator.device) {
						navigator.device.exitApp();
					}
				}
				*/
			}
			else
			{
				
			}
		}
		function isHighDensity(){
			return ((window.matchMedia && (window.matchMedia('only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)').matches || window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)').matches)) || (window.devicePixelRatio && window.devicePixelRatio > 1.3));
		}
		function isRetina(){
			return ((window.matchMedia && (window.matchMedia('only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)').matches || window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)').matches)) || (window.devicePixelRatio && window.devicePixelRatio >= 2)) && /(iPad|iPhone|iPod)/g.test(navigator.userAgent);
		}
		$(document).ready(function(){

		});
		
		function need_internet(){
			if(does_we_have_intenet)
				return true;
			else
				return false;
		};
		function need_internet_alert(){
			navigator.notification.alert(
				'شما برای مشاهده این صفحه نیاز به اینترنت دارید',  // message
				alertDismissed,         // callback
				'اخطار',            // title
				'تائید'                  // buttonName
			);
			function alertDismissed(){};
		};
		
		function uniqueDeviceIDsuccess_index(uuid)
		{
			window.localStorage.setItem('uuid',uuid);
		};
		function uniqueDeviceIDfail_index(uuid)
		{
			//alert("uniqueDeviceIDfail" + uuid);
		};
	</script>	

		
		
		
<style>


</style>	
</head>
<body onload="init();" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" id="body" class="smm_body retina">
	<div class="bg" ></div>
	<div class="container " id="container" >
		<div id="ajax" class="mypreload">
			<div style="z-index: 1000; border: medium none; margin: 0px; padding: 0px; width: 100%; height: 100%; top: 0px; left: 0px; background-color: #1e92c4; opacity: 1; cursor: default; position: fixed;overflow:visible;" class="blockUI blockOverlay"></div>
			<div style="z-index: 1011; position: fixed; padding: 0px; margin: 0px; width: 100%; top: 28%; left: 0%; text-align: center;border: medium none;overflow:visible;" class="blockUI blockMsg blockPage"><img src="images/preloader.gif"></div>
			<div style="z-index: 1012; position: fixed; padding: 0px; margin: 0px; width: 100%; top: 50%; left: 0%; text-align: center;border: medium none;overflow:visible;height:500px;" class="blockUI blockMsg blockPage"><img src="images/loading.png" width="70%"></div>
		</div>
		<div class="smm_content">
			<div class="smm_title retina"></div>
			<div class="smm_menu">
				<div id="smm_wrapper">
					<ul class="retina">
						<li onclick="goto_next_page('news.html',true);" title="news" class="goto222 internet"></li>
						<li onclick="goto_next_page('picturesCategories.html',true);" title="gallery" class="goto internet"></li>
						<li onclick="goto_next_page('live.html',true);" title="live broadcast" class="goto internet"></li>
						<li onclick="goto_next_page('videoCategories.html',true);" title="video" class="goto internet"></li>
						<li onclick="goto_next_page('radio.html',true);" title="radio" class="goto internet"></li>
						<li onclick="goto_next_page('map.html',false);" title="map" class="goto" ></li>
						<li onclick="goto_next_page('adab.html',false);" title="adab al-ziyarat" class="goto" ></li>
						<li onclick="goto_next_page('salat.html',false);" title="PrayTimes" class="goto PrayTimes_page" ></li>
						<li onclick="goto_next_page('ziarat.html',true);" title="naeb al-ziyarat" class="goto internet"></li>
						<li onclick="goto_next_page('vtour-demo-day.html',false);" title="vtour" class="goto" ></li>
						<li onclick="goto_next_page('index.html',true);" title="majalat" class="goto internet"></li>
						<!--<li style="background-color: transparent ! important;"></li>-->
					</ul>
				</div>
			</div>
		</div>
			
	</div>
</body>
</html>